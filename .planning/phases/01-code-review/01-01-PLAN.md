---
phase: 01-code-review
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - .planning/phases/01-code-review/reports/exceptions-report.md
  - pyproject.toml
autonomous: true

must_haves:
  truths:
    - "Toutes les bare exceptions sont documentees avec fichier et ligne"
    - "Les except Exception sont classifies comme intentionnel ou a corriger"
    - "Un rapport structure existe avec recommandations par fichier"
  artifacts:
    - path: ".planning/phases/01-code-review/reports/exceptions-report.md"
      provides: "Rapport complet des exceptions"
      contains: "| File | Line |"
  key_links:
    - from: "ruff check output"
      to: "exceptions-report.md"
      via: "classification manuelle"
      pattern: "E722|BLE001"
---

<objective>
Analyser tous les patterns d'exception dans le codebase et produire un rapport classe.

Purpose: REVIEW-01 exige d'identifier toutes les bare exceptions. Ce plan utilise ruff pour scanner, puis classifie chaque instance comme intentionnelle ou a corriger.
Output: .planning/phases/01-code-review/reports/exceptions-report.md
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-code-review/01-RESEARCH.md

# Key files to scan
@core/hardware/moteur.py
@core/hardware/feedback_controller.py
@services/motor_service.py
@ems22d_calibrated.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Configurer ruff pour detection exceptions et scanner</name>
  <files>pyproject.toml</files>
  <action>
1. Verifier la configuration ruff existante dans pyproject.toml
2. S'assurer que les regles suivantes sont activees:
   - E722: bare except
   - BLE001: blind except Exception
   - B012, B013, B014, B017, B904: bugbear exception rules
3. Executer ruff check sur core/, services/, scripts/:
   ```bash
   cd /home/jp/PythonProject/Dome_web_v4_6
   uv run ruff check core/ services/ scripts/ ems22d_calibrated.py --select E722,BLE001,B012,B013,B014,B017,B904 --output-format=grouped
   ```
4. Capturer la sortie complete pour analyse

Ne pas utiliser --fix automatiquement - le but est d'identifier, pas de corriger.
  </action>
  <verify>ruff check termine sans erreur et produit une liste d'issues</verify>
  <done>Liste complete des violations d'exception capturee</done>
</task>

<task type="auto">
  <name>Task 2: Classifier et documenter les exceptions</name>
  <files>.planning/phases/01-code-review/reports/exceptions-report.md</files>
  <action>
Pour chaque exception identifiee par ruff, creer une entree dans le rapport avec:

1. **Classification:**
   - "Intentionnel" si: daemon code (motor_service, ems22d), probe hardware, test code
   - "A corriger" si: code metier, peut specifier exception concrete
   - "A evaluer" si: contexte ambigu

2. **Structure du rapport:**
```markdown
# Exception Handling Report

## Summary
- Bare except (E722): X instances
- Blind except Exception (BLE001): Y instances
- Total: Z instances

## By Category

### Intentional (with justification)
| File | Line | Pattern | Justification |
|------|------|---------|---------------|

### To Fix (with recommendation)
| File | Line | Pattern | Recommendation |
|------|------|---------|----------------|

### To Evaluate (need more context)
| File | Line | Pattern | Question |
|------|------|---------|----------|

## Recommendations
[Prioritized list of fixes]
```

3. Pour chaque fichier avec exceptions, ouvrir et comprendre le contexte avant de classifier.
4. Utiliser les findings de la recherche: 14 bare except dans scripts/diagnostics/ sont probablement intentionnels.
  </action>
  <verify>Le rapport contient toutes les exceptions identifiees et chaque entree a une classification</verify>
  <done>Rapport exceptions-report.md complet avec classification et recommandations</done>
</task>

</tasks>

<verification>
- [ ] ruff check execute sans erreur
- [ ] Toutes les violations E722 et BLE001 sont dans le rapport
- [ ] Chaque violation a une classification (Intentionnel/A corriger/A evaluer)
- [ ] Les recommandations sont priorisees par impact
</verification>

<success_criteria>
1. exceptions-report.md existe et contient un tableau structure
2. Les 14 bare except de scripts/diagnostics/ sont documentes
3. Les 57+ except Exception sont classifies avec justification
4. Les recommandations prioritaires sont listees
</success_criteria>

<output>
After completion, create `.planning/phases/01-code-review/01-01-SUMMARY.md`
</output>
