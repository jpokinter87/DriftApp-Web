---
phase: 02-dashboard-modernization
plan: 01
type: execute
wave: 1
depends_on: ["01-02"]
files_modified:
  - web/templates/dashboard.html
  - web/static/css/dashboard.css
autonomous: false
---

<objective>
## Goal
Migrer le template dashboard.html vers l'heritage base.html et convertir tout le layout (grille 2 colonnes, section boussole, section controles, logs, footer) en classes Tailwind + composants Phase 1.

## Purpose
Premiere etape de la modernisation du dashboard — eliminer le HTML/CSS standalone et unifier avec le design system Tailwind etabli en Phase 1. Le dashboard est la page principale utilisee pendant les sessions d'astrophotographie.

## Output
- `web/templates/dashboard.html` — extend base.html, layout Tailwind, memes IDs/classes JS
- `web/static/css/dashboard.css` — reduit aux styles specifiques (canvas, animations GOTO modal, encodeur frozen)
</objective>

<context>
## Project Context
@.paul/PROJECT.md
@.paul/ROADMAP.md
@.paul/STATE.md

## Prior Work
@.paul/phases/01-foundation-stack-setup/01-02-SUMMARY.md
- 38 composants Tailwind disponibles (panel, btn-*, input-field, log-container, modal-*, etc.)
- base.html avec header/nav/footer et heritage Django

## Source Files
@web/templates/dashboard.html — template actuel (standalone, ~230 lignes HTML)
@web/templates/base.html — template de base Phase 1 (heritage Django)
@web/static/css/dashboard.css — CSS actuel (~1500 lignes, layout + modals + animations)
@web/static/css/tailwind-input.css — composants Tailwind v4 (400 lignes, 38 classes)
@web/static/js/dashboard.js — JS actuel (1590 lignes, references DOM par ID)
</context>

<skills>
## Required Skills (from SPECIAL-FLOWS.md)

| Skill | Priority | When to Invoke | Loaded? |
|-------|----------|----------------|---------|
| /frontend-design | required | Avant modification du template HTML | ○ |

**BLOCKING:** Required skills MUST be loaded before APPLY proceeds.

## Skill Invocation Checklist
- [ ] /frontend-design loaded
</skills>

<acceptance_criteria>

## AC-1: Heritage base.html fonctionnel
```gherkin
Given le dashboard.html migre
When on visite http://localhost:8000/
Then le header/nav/footer de base.html s'affichent correctement
And l'onglet "Controle" est marque actif
And les Google Fonts et Alpine.js sont charges (via base.html head)
```

## AC-2: Layout 2 colonnes Tailwind
```gherkin
Given le dashboard avec classes Tailwind
When on affiche la page sur desktop (>1024px)
Then la grille affiche boussole a gauche (~350px) et controles a droite (flex-1)
And les panels utilisent la classe .panel de Phase 1
And le theme observatory dark est preserve
```

## AC-3: IDs DOM preserves pour le JS
```gherkin
Given le template migre
When dashboard.js s'execute
Then tous les getElementById fonctionnent (compass, dome-position, dome-target, etc.)
And le polling API, la boussole canvas, et les event listeners fonctionnent sans modification JS
And les deux modals (GOTO, Update) s'affichent et se ferment correctement
```

## AC-4: CSS dashboard reduit
```gherkin
Given la migration vers Tailwind
When on inspecte dashboard.css
Then seuls les styles specifiques restent (canvas, animations, enc-frozen, GOTO modal, update modal)
And les styles de layout generaux (.container, .header, .main-content, .control-section) sont supprimes
And les styles de composants (.btn, .btn-primary, .input-group) sont supprimes
```

</acceptance_criteria>

<tasks>

<task type="auto">
  <name>Task 1: Migrer dashboard.html vers heritage base.html</name>
  <files>web/templates/dashboard.html</files>
  <action>
    Remplacer le template standalone par un template Django heritant de base.html:

    1. Remplacer le DOCTYPE/head/body par {% extends "base.html" %}
    2. Ajouter {% block title %}Controle Coupole{% endblock %}
    3. Ajouter {% block extra_css %} avec lien vers dashboard.css
    4. Ajouter {% block extra_js %} avec lien vers dashboard.js
    5. Mettre tout le contenu dans {% block content %}
    6. Supprimer le header (hérité de base.html) — mais garder le status indicator en le déplaçant dans {% block status_indicator %}
    7. Supprimer le footer (hérité de base.html)

    Pour le layout principal dans {% block content %}:
    - Grille 2 colonnes: `grid grid-cols-[350px_1fr] gap-4 mb-4` (avec responsive `max-lg:grid-cols-1`)
    - Section boussole gauche: utiliser classe `.panel` + contenu compass
    - Section controles droite: `flex flex-col gap-4` avec chaque sous-panel en `.panel`
    - Section logs en bas: `.panel` avec log-container

    IMPORTANT: Conserver TOUS les IDs existants (compass, dome-position, dome-target, encoder-calibrated, tracking-mode-indicator, corrections-count, corrections-total, enc-item, etc.) — le JS les reference par getElementById.

    IMPORTANT: Conserver TOUS les elements hidden de compatibilite JS (tracking-mode, tracking-corrections, tracking-remaining).

    IMPORTANT: Conserver les deux modals (goto-modal, update-modal) intégralement — elles seront migrées en 02-03.

    Convertir les classes CSS en Tailwind inline:
    - .compass-section → .panel
    - .compass-section h2 → section-title
    - .compass-container → flex justify-center mb-4
    - .position-info → grid grid-cols-2 gap-2
    - .position-info .info-item → info-item (composant Phase 1)
    - .control-panel → .panel
    - .control-panel h3 → section-title
    - .input-group → input-group (composant Phase 1)
    - .button-group → button-group (composant Phase 1)
    - .jog-buttons → flex gap-2 mb-4
    - .continuous-buttons → flex gap-2 mb-4
    - .goto-group → flex gap-2
    - .logs-section → .panel
    - .logs-container → log-container (composant Phase 1)
    - .tracking-info → .panel avec border-2 border-accent-green
    - .info-grid-simple → info-grid

    Pour les boutons, utiliser les composants Phase 1:
    - .btn .btn-primary → btn btn-primary
    - .btn .btn-secondary → btn btn-secondary
    - .btn .btn-danger → btn btn-danger
    - .btn .btn-jog → btn btn-jog
    - .btn .btn-stop → btn btn-stop
    - .btn .btn-continuous → btn btn-continuous

    Pour les inputs:
    - input → input-field
  </action>
  <verify>
    cd /home/jp/PythonProject/Dome_web_v4_6 && python -c "
from django.template.loader import get_template
import django, os
os.environ['DJANGO_SETTINGS_MODULE'] = 'web.driftapp_web.settings'
django.setup()
t = get_template('dashboard.html')
# Verify template loads and extends base.html
print('Template loaded OK')
# Check all critical IDs are present
import re
with open('web/templates/dashboard.html') as f:
    content = f.read()
ids = ['compass', 'dome-position', 'dome-target', 'encoder-calibrated',
       'btn-search', 'btn-start-tracking', 'btn-stop-tracking',
       'btn-jog-ccw-10', 'btn-jog-cw-10', 'btn-stop', 'goto-angle',
       'btn-goto', 'logs', 'goto-modal', 'update-modal',
       'tracking-info', 'service-status', 'object-name']
missing = [id for id in ids if f'id=\"{id}\"' not in content]
assert not missing, f'Missing IDs: {missing}'
assert '{% extends' in content, 'Missing extends'
print('All critical IDs present')
print('Heritage base.html OK')
"
  </verify>
  <done>AC-1 et AC-3 satisfaits: heritage base.html fonctionnel, tous les IDs DOM preserves</done>
</task>

<task type="auto">
  <name>Task 2: Epurer dashboard.css — supprimer les styles migres</name>
  <files>web/static/css/dashboard.css</files>
  <action>
    Supprimer de dashboard.css tous les styles desormais geres par Tailwind ou base.html:

    SUPPRIMER:
    - :root (variables CSS — desormais dans @theme Tailwind)
    - *, body (reset — gere par Tailwind base)
    - .container (layout — gere par base.html)
    - .header, .header-left, .nav-tabs, .nav-tab (navigation — base.html)
    - .status-indicator, .status-dot (base — mais garder .connected, .disconnected, .moving specifiques au JS)
    - .main-content (grille — Tailwind inline)
    - .compass-section, .compass-section h2 (panel — Tailwind .panel)
    - .compass-container (.flex dans template)
    - .position-info (grille — Tailwind inline)
    - .control-section, .control-panel, .control-panel h3 (panel — Tailwind)
    - .input-group et .input-group input (composant Tailwind)
    - .object-info (Tailwind inline)
    - .btn, .btn-primary, .btn-secondary, .btn-danger (composants Tailwind)
    - .button-group (composant Tailwind)
    - .tracking-info, .tracking-info h3 (panel Tailwind)
    - .info-grid, .info-grid .info-item (composant Tailwind)
    - .jog-buttons (flex Tailwind)
    - .btn-jog, .btn-stop (composants Tailwind)
    - .goto-group, .goto-group input (Tailwind inline)
    - .logs-section, .logs-section h3, .logs-container, .log-entry (composants Tailwind)
    - .footer (base.html)
    - .info-grid-simple (info-grid Tailwind)
    - .continuous-buttons, .btn-continuous (composants Tailwind)
    - @media responsive generiques pour layout (geres par Tailwind responsive)

    CONSERVER:
    - .status-dot.connected, .status-dot.disconnected, .status-dot.moving + @keyframes pulse (JS toggle)
    - #compass (style canvas specifique)
    - .hidden (utilitaire JS — display: none)
    - Cartouches specifiques: .coupole-item, .coupole-value, .telescope-item, .telescope-value
    - Encodeur: .enc-item, .enc-absent, .enc-uncalibrated, .enc-calibrated, .enc-frozen + @keyframes neon-pulse-red, text-blink
    - Mode: .mode-item, .mode-value, .mode-value.normal/critical/continuous/fast_track
    - Corrections: .corrections-item, .corrections-left, .corrections-count, .corrections-right, .corrections-total
    - Flash: .flash-success + @keyframes flash-fire-border
    - GOTO Modal complet: .goto-modal, .goto-modal-content, etc. + animations chevrons
    - Update Modal complet: .update-modal, .update-modal-content, etc.
    - .goto-details + @keyframes pulse-goto
    - @keyframes pulse-continuous
    - @media responsive specifiques aux modals
    - @media max-height pour #compass et elements specifiques

    Ajouter un commentaire en haut:
    /* DriftApp Dashboard — Styles specifiques (post-migration Tailwind Phase 2) */
    /* Layout et composants generaux: Tailwind CSS + base.html */

    NOTE: NE PAS modifier le fichier JS (dashboard.js) — il sera migre en 02-03.
  </action>
  <verify>
    cd /home/jp/PythonProject/Dome_web_v4_6 && python -c "
import re
with open('web/static/css/dashboard.css') as f:
    content = f.read()

# Verify removed styles
removed = ['.container {', '.header {', '.main-content {', '.footer {',
           '.btn-primary {', '.input-group {', '.logs-section {',
           ':root {', '.nav-tab {']
still_present = [r for r in removed if r in content]
assert not still_present, f'Should be removed: {still_present}'

# Verify kept styles
kept = ['.enc-frozen', '.goto-modal', '.update-modal', '.mode-value.normal',
        '#compass', '.flash-success', '.coupole-item']
missing = [k for k in kept if k not in content]
assert not missing, f'Should be kept: {missing}'

lines = content.count('\n')
print(f'dashboard.css: {lines} lignes (reduit)')
print('Styles migres supprimes, specifiques conserves')
"
  </verify>
  <done>AC-4 satisfait: CSS reduit aux styles specifiques, layout/composants supprimes</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
    Dashboard migre vers heritage base.html avec layout Tailwind:
    - Template herite de base.html (header/nav/footer partages)
    - Grille 2 colonnes en classes Tailwind
    - Panels avec composants Phase 1 (.panel, .btn-*, .input-field)
    - CSS reduit (~400 lignes vs ~1500 avant)
    - JS inchange (memes IDs, meme polling)
  </what-built>
  <how-to-verify>
    1. Lancer le serveur: cd web && python manage.py runserver 0.0.0.0:8000
    2. Visiter http://localhost:8000/
    3. Verifier: Header DriftApp avec nav (Controle actif, Systeme, Session)
    4. Verifier: Layout 2 colonnes (boussole gauche, controles droite)
    5. Verifier: Boussole canvas fonctionne (aiguilles, etoiles)
    6. Verifier: Panels ont le style observatory dark theme
    7. Verifier: Boutons JOG, STOP, Continuous, GOTO visibles et cliquables
    8. Verifier: Zone de logs en bas affiche "Interface initialisee"
    9. Verifier: Footer avec version et horloge
    10. Tester responsive: reduire la fenetre — la grille passe en colonne unique
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<boundaries>

## DO NOT CHANGE
- web/static/js/dashboard.js (migration JS → Alpine.js = Plan 02-03)
- web/templates/base.html (etabli en Phase 1)
- web/static/css/tailwind-input.css (composants Phase 1)
- web/templates/system.html, web/templates/session.html (autres phases)
- core/, services/ (backend Python)

## SCOPE LIMITS
- Ce plan migre le LAYOUT uniquement — pas les interactions JS
- Les modals (GOTO, Update) gardent leur CSS actuel — migration en 02-03
- Pas de refactoring du canvas compass (widget custom conserve)
- Pas de nouveaux composants Tailwind — utiliser ceux de Phase 1
- Pas de migration Alpine.js dans ce plan

</boundaries>

<verification>
Before declaring plan complete:
- [ ] `python manage.py check` passe sans erreur
- [ ] Le template dashboard.html charge sans erreur Django
- [ ] Tous les IDs DOM critiques sont presents dans le HTML
- [ ] Le CSS dashboard.css ne contient plus de styles de layout generaux
- [ ] La page s'affiche correctement (verification humaine)
- [ ] Les boutons et inputs sont cliquables
- [ ] La boussole canvas se dessine
</verification>

<success_criteria>
- dashboard.html herite de base.html
- Layout en classes Tailwind (pas de CSS layout custom)
- dashboard.css reduit de ~1500 a ~400 lignes
- Zero regression JS (tous IDs preserves)
- Verification visuelle approuvee
</success_criteria>

<output>
After completion, create `.paul/phases/02-dashboard-modernization/02-01-SUMMARY.md`
</output>
