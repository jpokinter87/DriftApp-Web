---
phase: 05-polish-responsive
plan: 01
type: execute
wave: 1
depends_on: ["04-02"]
files_modified:
  - web/static/css/tailwind-input.css
  - web/templates/dashboard.html
  - web/templates/system.html
  - web/templates/session.html
  - web/static/css/dashboard.css
autonomous: false
---

<objective>
## Goal
Factoriser les styles CSS dupliques, ajouter les breakpoints responsive manquants, et supprimer les fichiers CSS morts.

## Purpose
Trois pages dupliquent panel-astro et section-title-fire en inline CSS. Les tables debordent sur mobile. Le dashboard a une colonne fixe 350px. Deux fichiers CSS (system.css, session.css) sont orphelins. Ce plan consolide et rend l'interface responsive.

## Output
- `web/static/css/tailwind-input.css` — composants factorises (panel-astro, section-title-fire, pulse keyframe)
- `web/templates/system.html` — inline CSS supprime, classes partagees utilisees
- `web/templates/session.html` — inline CSS supprime, classes partagees utilisees, tables responsive
- `web/templates/dashboard.html` — grille responsive amelioree, tables responsive
- `web/static/css/dashboard.css` — nettoyage doublons devenus inutiles
- Fichiers supprimes: `web/static/css/system.css`, `web/static/css/session.css`
</objective>

<context>
## Project Context
@.paul/PROJECT.md
@.paul/ROADMAP.md

## Prior Work
@.paul/phases/04-session-page-modernization/04-02-SUMMARY.md
- Toutes les 3 pages migrees vers base.html avec Tailwind + Alpine.js
- panel-astro et section-title-fire dupliques en inline sur system.html et session.html
- session.css et system.css jamais charges (fichiers morts)

## Source Files
@web/static/css/tailwind-input.css — composants @layer components (24 classes)
@web/static/css/dashboard.css — 823 lignes, contient panel-astro/section-title-fire originaux
@web/templates/dashboard.html — grille grid-cols-[350px_1fr]
@web/templates/system.html — inline CSS duplique (panel-astro, section-title-fire, sys-*)
@web/templates/session.html — inline CSS duplique + styles session-specifiques
</context>

<skills>
## Required Skills (from SPECIAL-FLOWS.md)

| Skill | Priority | When to Invoke | Loaded? |
|-------|----------|----------------|---------|
| /frontend-design | required | Avant modification du template HTML | ○ |

**BLOCKING:** Required skills MUST be loaded before APPLY proceeds.

## Skill Invocation Checklist
- [ ] /frontend-design loaded
</skills>

<acceptance_criteria>

## AC-1: Styles partages factorises dans tailwind-input.css
```gherkin
Given les styles panel-astro, section-title-fire et pulse keyframe
When les 3 pages sont chargees
Then les styles viennent de tailwind-input.css @layer components
And aucun inline CSS ne duplique ces definitions
And l'apparence visuelle est identique
```

## AC-2: Responsive sur les 3 pages
```gherkin
Given un ecran de 375px de large (mobile)
When les 3 pages sont visitees
Then aucun element ne deborde horizontalement
And les grilles s'empilent correctement
And les tables ont un scroll horizontal si necessaire
```

## AC-3: Fichiers CSS morts supprimes
```gherkin
Given les fichiers system.css et session.css
When on verifie leur chargement
Then ils n'existent plus dans le projet
And aucune page ne les reference
```

## AC-4: Zero regression visuelle
```gherkin
Given les modifications CSS
When les 3 pages sont visitees sur desktop (1920px)
Then l'apparence est identique a avant
And les animations/transitions fonctionnent
```

</acceptance_criteria>

<tasks>

<task type="auto">
  <name>Task 1: Factoriser les styles partages et supprimer les fichiers morts</name>
  <files>web/static/css/tailwind-input.css, web/static/css/dashboard.css, web/templates/system.html, web/templates/session.html</files>
  <action>
    **1. Dans tailwind-input.css**, ajouter dans @layer components:

    a) `.panel-astro` — copier la definition exacte depuis dashboard.css (background SVG avec etoiles, hover shadow)
       - IMPORTANT: mettre `transition: box-shadow 0.3s ease` sur le selecteur BASE (pas :hover)

    b) `.section-title-fire` — copier la definition depuis dashboard.css (gradient text)

    c) `@keyframes shared-pulse` — definir une seule fois:
       `0%, 100% { opacity: 1 } 50% { opacity: 0.5 }`

    d) `.animate-pulse-status` — `animation: shared-pulse 2s ease-in-out infinite`

    **2. Dans dashboard.css:**
    - Supprimer la definition `.panel-astro` (maintenant dans tailwind-input.css)
    - Supprimer la definition `.section-title-fire` (maintenant dans tailwind-input.css)
    - GARDER tout le reste (compass, modals, tracking glow, etc.)

    **3. Dans system.html:**
    - Supprimer les blocs inline `.panel-astro` et `.section-title-fire` du premier `<style>`
    - Remplacer `@keyframes sys-pulse` par `.animate-pulse-status` dans le HTML la ou c'est utilise
    - GARDER les styles specifiques systeme (sys-badge, sys-card, ipc-fresh, etc.)

    **4. Dans session.html:**
    - Supprimer les blocs inline `.panel-astro` et `.section-title-fire` du `<style>`
    - Remplacer `@keyframes session-pulse` par `.animate-pulse-status`
    - GARDER les styles specifiques session (selector-tab, stat-card, mode-bar, chart-wrapper, etc.)

    **5. Supprimer les fichiers morts:**
    - `web/static/css/system.css` (469 lignes, jamais charge)
    - `web/static/css/session.css` (720 lignes, jamais charge)

    IMPORTANT: Ne PAS modifier le HTML structure — uniquement les blocs `<style>`
    IMPORTANT: Verifier que .panel-astro dans tailwind-input.css inclut le SVG data URI complet
    IMPORTANT: Apres suppression dans dashboard.css, verifier que les classes ne sont pas referencees ailleurs
  </action>
  <verify>
    python -c "
with open('web/static/css/tailwind-input.css') as f:
    css = f.read()
assert '.panel-astro' in css, 'Missing panel-astro in tailwind-input.css'
assert '.section-title-fire' in css, 'Missing section-title-fire in tailwind-input.css'
assert 'shared-pulse' in css, 'Missing shared-pulse keyframe'

with open('web/templates/system.html') as f:
    html = f.read()
assert '.panel-astro' not in html, 'panel-astro still inline in system.html'
assert '.section-title-fire' not in html, 'section-title-fire still inline in system.html'

with open('web/templates/session.html') as f:
    html = f.read()
assert '.panel-astro' not in html, 'panel-astro still inline in session.html'
assert '.section-title-fire' not in html, 'section-title-fire still inline in session.html'

import os
assert not os.path.exists('web/static/css/system.css'), 'system.css still exists'
assert not os.path.exists('web/static/css/session.css'), 'session.css still exists'

print('✓ Styles factorises, fichiers morts supprimes')
"
  </verify>
  <done>AC-1 et AC-3 satisfaits: styles partages dans tailwind-input.css, fichiers morts supprimes</done>
</task>

<task type="auto">
  <name>Task 2: Ajouter les breakpoints responsive manquants</name>
  <files>web/templates/dashboard.html, web/templates/system.html, web/templates/session.html, web/static/css/tailwind-input.css</files>
  <action>
    **1. Dashboard — grille responsive:**
    - Remplacer `grid grid-cols-[350px_1fr]` par `grid grid-cols-1 lg:grid-cols-[350px_1fr]`
    - Cela empile compass + controles sur mobile/tablette, 2 colonnes sur desktop
    - Les canvas 320x320 sont deja contenus dans leur parent

    **2. Tables responsive (session.html):**
    - Envelopper les tables corrections et GOTO dans `<div class="overflow-x-auto">`
    - Cela ajoute un scroll horizontal sur petit ecran

    **3. Tables responsive (system.html):**
    - Envelopper la table "Modes Adaptatifs" dans `<div class="overflow-x-auto">`

    **4. Session mode-bar-container:**
    - Dans l'inline CSS de session.html, changer le grid-template-columns de
      `100px 1fr 80px` a `minmax(60px, 100px) 1fr minmax(40px, 80px)`
    - Cela permet au grid de se comprimer sur petit ecran

    **5. prefers-reduced-motion:**
    - Dans tailwind-input.css, ajouter a la fin:
      ```css
      @media (prefers-reduced-motion: reduce) {
          *, *::before, *::after {
              animation-duration: 0.01ms !important;
              animation-iteration-count: 1 !important;
              transition-duration: 0.01ms !important;
          }
      }
      ```

    IMPORTANT: Ne PAS changer les breakpoints existants qui fonctionnent
    IMPORTANT: GARDER max-lg:grid-cols-1 sur le dashboard si deja present
    IMPORTANT: Ne PAS modifier la taille du canvas compass (gere par JS)
  </action>
  <verify>
    python -c "
with open('web/templates/dashboard.html') as f:
    html = f.read()
assert 'lg:grid-cols-[350px_1fr]' in html or 'lg:grid-cols-[350px' in html, 'Missing responsive dashboard grid'
assert 'grid-cols-1' in html, 'Missing mobile stacking for dashboard'

with open('web/templates/session.html') as f:
    html = f.read()
assert 'overflow-x-auto' in html, 'Missing overflow-x-auto on session tables'

with open('web/templates/system.html') as f:
    html = f.read()
assert 'overflow-x-auto' in html, 'Missing overflow-x-auto on system table'

with open('web/static/css/tailwind-input.css') as f:
    css = f.read()
assert 'prefers-reduced-motion' in css, 'Missing prefers-reduced-motion'

print('✓ Breakpoints responsive et prefers-reduced-motion ajoutes')
"
  </verify>
  <done>AC-2 satisfait: responsive sur les 3 pages, pas de debordement horizontal</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
    Factorisation CSS et responsive:
    - panel-astro, section-title-fire et pulse keyframe factorises dans tailwind-input.css
    - system.css et session.css supprimes (fichiers morts)
    - Dashboard grille responsive (empilage mobile)
    - Tables avec scroll horizontal sur mobile
    - prefers-reduced-motion global
  </what-built>
  <how-to-verify>
    1. Lancer: cd web && python manage.py runserver 0.0.0.0:8000
    2. Rebuild CSS: ./scripts/build_css.sh (ou tailwindcss CLI)

    **Desktop (1920px):**
    3. Visiter http://localhost:8000/ — apparence identique
    4. Visiter http://localhost:8000/api/health/system/ — apparence identique
    5. Visiter http://localhost:8000/session/ — apparence identique
    6. Verifier les panels ont le fond etoile (panel-astro)
    7. Verifier les titres ont le gradient feu (section-title-fire)

    **Mobile (F12 > responsive > 375px):**
    8. Dashboard: compass et controles empiles verticalement
    9. System: grilles empilees, table scrollable
    10. Session: charts empiles, tables scrollables, stats sur 2 colonnes

    11. Verifier: aucune erreur console (hors 404 normal)
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<boundaries>

## DO NOT CHANGE
- web/templates/base.html (Phase 1)
- web/static/js/dashboard.js (Phase 2)
- web/static/js/system.js (Phase 3)
- web/static/js/session.js (Phase 4)
- core/, services/ (backend)
- web/session/views.py, web/hardware/views.py (backend API)

## SCOPE LIMITS
- Ce plan factorize les CSS et ajoute le responsive
- Pas de modification de la logique JS
- Pas d'ajout d'animations nouvelles (plan 05-02)
- Pas de modifications d'accessibilite aria (plan 05-02)
- Pas de nettoyage du legacy dans dashboard.css au-dela de panel-astro/section-title-fire (plan 05-02)

</boundaries>

<verification>
Before declaring plan complete:
- [ ] panel-astro et section-title-fire dans tailwind-input.css, plus en inline
- [ ] system.css et session.css supprimes
- [ ] Dashboard responsive (empilage mobile)
- [ ] Tables avec overflow-x-auto
- [ ] prefers-reduced-motion present
- [ ] Les 3 pages identiques visuellement sur desktop
- [ ] Pas de debordement horizontal sur mobile (375px)
- [ ] Verification visuelle approuvee
</verification>

<success_criteria>
- Styles partages factorises (une seule source de verite)
- Fichiers CSS morts supprimes
- Interface responsive sur mobile 375px
- Zero regression visuelle sur desktop
- prefers-reduced-motion respecte
- Verification humaine approuvee
</success_criteria>

<output>
After completion, create `.paul/phases/05-polish-responsive/05-01-SUMMARY.md`
</output>
