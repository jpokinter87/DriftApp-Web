---
phase: 05-polish-responsive
plan: 02
type: execute
wave: 1
depends_on: ["05-01"]
files_modified:
  - web/static/css/tailwind-input.css
  - web/static/css/dashboard.css
  - web/templates/base.html
  - web/templates/dashboard.html
  - web/templates/system.html
  - web/templates/session.html
autonomous: false
---

<objective>
## Goal
Nettoyer le CSS legacy dans dashboard.css et tailwind-input.css, et ajouter l'accessibilite de base (aria, focus states) aux 3 pages via base.html.

## Purpose
dashboard.css contient du code mort (fast_track, mode-* doublons). tailwind-input.css a des composants modal jamais utilises. L'interface manque d'attributs aria, de focus states visibles et de landmarks semantiques. Ce plan finalise le milestone v5.0.

## Output
- `web/static/css/dashboard.css` — legacy code removed
- `web/static/css/tailwind-input.css` — unused modal components removed, focus ring added
- `web/templates/base.html` — aria landmarks, nav accessibility
- `web/templates/dashboard.html` — aria on canvas, modals
- `web/templates/system.html` — minor aria additions
- `web/templates/session.html` — minor aria additions
</objective>

<context>
## Project Context
@.paul/PROJECT.md
@.paul/ROADMAP.md

## Prior Work
@.paul/phases/05-polish-responsive/05-01-SUMMARY.md
- panel-astro/section-title-fire factorises, fichiers morts supprimes
- Responsive breakpoints ajoutes
- prefers-reduced-motion etabli

## Source Files
@web/static/css/dashboard.css — 790 lignes, contient legacy fast_track, timer-widget, mode-* doublons
@web/static/css/tailwind-input.css — contient .modal-overlay/.modal-content jamais utilises
@web/templates/base.html — nav sans aria, pas de landmarks
@web/templates/dashboard.html — canvas sans aria, modals sans role="dialog"
</context>

<skills>
## Required Skills (from SPECIAL-FLOWS.md)

| Skill | Priority | When to Invoke | Loaded? |
|-------|----------|----------------|---------|
| /frontend-design | required | Avant modification du template HTML | ○ |

**BLOCKING:** Required skills MUST be loaded before APPLY proceeds.

## Skill Invocation Checklist
- [ ] /frontend-design loaded
</skills>

<acceptance_criteria>

## AC-1: Legacy CSS nettoye
```gherkin
Given dashboard.css et tailwind-input.css
When le code legacy est supprime
Then .mode-value.fast_track n'existe plus dans dashboard.css
And .mode-fast_track n'existe plus dans dashboard.css
And les .mode-normal/.critical/.continuous doublons sont retires de dashboard.css
And .modal-overlay et .modal-content sont retires de tailwind-input.css
And le timer-widget CSS est retire de dashboard.css
```

## AC-2: Accessibilite de base dans base.html
```gherkin
Given base.html (template parent)
When la page est inspectee
Then <nav> a un aria-label
And <main> a un role="main" ou est semantique
And les liens nav ont un focus ring visible
```

## AC-3: Accessibilite sur dashboard
```gherkin
Given la page dashboard
When inspectee par un lecteur d'ecran
Then le canvas compass a un aria-label
And les modals GOTO et Update ont role="dialog" et aria-modal="true"
```

## AC-4: Zero regression fonctionnelle
```gherkin
Given les modifications
When les 3 pages fonctionnent
Then aucune erreur console
And l'apparence est identique sur desktop
And les fonctionnalites JS sont preservees
```

</acceptance_criteria>

<tasks>

<task type="auto">
  <name>Task 1: Nettoyer le CSS legacy</name>
  <files>web/static/css/dashboard.css, web/static/css/tailwind-input.css</files>
  <action>
    **Dans dashboard.css, supprimer:**

    1. `.mode-value.fast_track` (lignes ~211-215) — mode FAST_TRACK supprime en v4.4
    2. `.mode-fast_track` (ligne ~220) — doublon du v4.4 legacy
    3. `.mode-normal`, `.mode-critical`, `.mode-continuous` (lignes ~217-219) — doublons de tailwind-input.css
    4. `.timer-widget { display: none !important; }` (lignes ~223-225) — le HTML a deja `hidden`
    5. `.hidden { display: none !important; }` (lignes ~95-97) — Tailwind fournit deja `hidden`

    **Dans tailwind-input.css, supprimer:**

    1. `.modal-overlay` et son contenu (lignes ~308-311) — jamais utilise, dashboard utilise goto-modal/update-modal
    2. `.modal-content` et son contenu (lignes ~313-316)
    3. `.modal-header` et son contenu (lignes ~318-324)
    4. `.modal-footer` et son contenu (lignes ~326-328)

    IMPORTANT: NE PAS supprimer .mode-value.normal/.critical/.continuous (utilises par JS)
    IMPORTANT: NE PAS modifier les modals goto-modal/update-modal dans dashboard.css
    IMPORTANT: Garder les keyframes fade-in et slide-up (ils sont references par @theme)
  </action>
  <verify>
    python -c "
with open('web/static/css/dashboard.css') as f:
    css = f.read()
assert 'fast_track' not in css, 'fast_track still in dashboard.css'
assert '.timer-widget' not in css, 'timer-widget CSS still in dashboard.css'
# mode-value.normal should still exist
assert '.mode-value.normal' in css, 'mode-value.normal removed (should keep)'

with open('web/static/css/tailwind-input.css') as f:
    css = f.read()
assert '.modal-overlay' not in css, 'modal-overlay still in tailwind-input.css'
assert '.modal-content' not in css, 'modal-content still in tailwind-input.css'
# shared components should still exist
assert '.panel-astro' in css, 'panel-astro removed (should keep)'
assert '.section-title-fire' in css, 'section-title-fire removed (should keep)'
print('✓ Legacy CSS nettoye')
"
  </verify>
  <done>AC-1 satisfait: legacy CSS supprime sans regression</done>
</task>

<task type="auto">
  <name>Task 2: Ajouter l'accessibilite de base</name>
  <files>web/templates/base.html, web/templates/dashboard.html, web/templates/system.html, web/templates/session.html, web/static/css/tailwind-input.css</files>
  <action>
    **Dans base.html:**

    1. Ajouter `aria-label="Navigation principale"` sur le `<nav>`
    2. Ajouter `role="banner"` sur le `<header>` (ou verifier qu'il est deja semantique)
    3. Ajouter `role="contentinfo"` sur le `<footer>` (ou verifier semantique)
    4. VERIFIER que `<main>` existe deja (semantiquement correct)

    **Dans tailwind-input.css**, ajouter un focus ring visible dans @layer base:
    ```css
    /* Focus ring for keyboard navigation */
    :focus-visible {
      outline: 2px solid var(--color-accent-amber);
      outline-offset: 2px;
    }
    ```

    **Dans dashboard.html:**

    1. Ajouter `aria-label="Boussole de position coupole"` sur le `<canvas id="compass">`
    2. Ajouter `role="dialog" aria-modal="true" aria-label="Deplacement GOTO"` sur `.goto-modal`
    3. Ajouter `role="dialog" aria-modal="true" aria-label="Mise a jour disponible"` sur `.update-modal`

    **Dans session.html:**

    1. Ajouter `aria-label="Graphique altitude"` sur le canvas `#altitude-chart`
    2. Ajouter `aria-label="Graphique azimut"` sur le canvas `#azimut-chart`

    IMPORTANT: Ne PAS modifier la structure HTML — uniquement ajouter des attributs
    IMPORTANT: Ne PAS modifier le JS
  </action>
  <verify>
    python -c "
with open('web/templates/base.html') as f:
    html = f.read()
assert 'aria-label' in html, 'Missing aria-label in base.html'

with open('web/templates/dashboard.html') as f:
    html = f.read()
assert 'role=\"dialog\"' in html, 'Missing role=dialog on modals'
assert 'aria-label' in html and 'compass' in html.lower() or 'Boussole' in html, 'Missing aria on canvas'

with open('web/templates/session.html') as f:
    html = f.read()
assert 'aria-label' in html, 'Missing aria-label in session.html'

with open('web/static/css/tailwind-input.css') as f:
    css = f.read()
assert 'focus-visible' in css, 'Missing focus-visible styles'

print('✓ Accessibilite de base ajoutee')
"
  </verify>
  <done>AC-2 et AC-3 satisfaits: landmarks, aria et focus ring ajoutes</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
    Nettoyage CSS legacy et accessibilite:
    - fast_track, timer-widget, mode doublons supprimes de dashboard.css
    - modal-overlay/content supprimes de tailwind-input.css
    - aria-label sur nav, canvas, modals
    - Focus ring visible (outline amber) pour navigation clavier
    - role="dialog" sur les modals GOTO et Update
  </what-built>
  <how-to-verify>
    1. Rebuild CSS: bash scripts/build_css.sh
    2. Lancer: cd web && python manage.py runserver 0.0.0.0:8000

    **Desktop:**
    3. Dashboard: apparence identique, boussole fonctionne
    4. System: apparence identique
    5. Session: apparence identique

    **Accessibilite:**
    6. Naviguer avec Tab — les liens/boutons ont un contour ambre visible
    7. F12 > Elements > verifier `<nav aria-label="...">`
    8. F12 > verifier `role="dialog"` sur les modals

    9. Aucune erreur console (hors 404 normal)
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<boundaries>

## DO NOT CHANGE
- web/static/js/dashboard.js (JS logic)
- web/static/js/system.js (JS logic)
- web/static/js/session.js (JS logic)
- core/, services/ (backend)
- web/session/views.py, web/hardware/views.py (backend API)
- .goto-modal, .goto-modal-content et tout le systeme modal dans dashboard.css (fonctionnel)
- .update-modal et tout le systeme update modal dans dashboard.css (fonctionnel)

## SCOPE LIMITS
- Ce plan nettoie le legacy et ajoute l'accessibilite de base
- Pas de refactoring de structure HTML
- Pas de modification de la logique JS
- Pas de nouvelles animations
- Pas de modifications responsive (fait en 05-01)

</boundaries>

<verification>
Before declaring plan complete:
- [ ] fast_track, timer-widget, mode doublons supprimes
- [ ] modal-overlay/content supprimes de tailwind-input.css
- [ ] aria-label sur nav, canvas compass, charts, modals
- [ ] Focus ring visible avec Tab
- [ ] Les 3 pages identiques visuellement sur desktop
- [ ] Aucune erreur console
- [ ] Verification visuelle approuvee
</verification>

<success_criteria>
- Legacy CSS nettoye (fast_track, timer-widget, mode doublons, modal unused)
- Accessibilite de base (aria landmarks, focus ring, dialog roles)
- Zero regression fonctionnelle et visuelle
- Verification humaine approuvee
</success_criteria>

<output>
After completion, create `.paul/phases/05-polish-responsive/05-02-SUMMARY.md`
</output>
